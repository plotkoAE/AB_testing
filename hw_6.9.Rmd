---
title: "hw_6.9"
output: html_document
date: "2023-01-14"
---
В файле parfume.csv приведены результаты маркетингового исследования, целью которого было выяснить предпочтения девушек от 18 до 25 лет относительно рекламы парфюмерной воды Black & White от Carolina Herrera (название изменено). Все девушки, участвовавшие в исследовании, были случайным образом распределены между контрольной и тестовой группой. Девушкам в контрольной группе показывали рекламный видеоролик в цветном варианте, а в тестовой — видеоролик в черно- белом варианте. Через некоторое время после демонстрации ролика фиксировалось, хотела бы девушка приобрести парфюмерную воду (значение 1) или нет (значение 0). 

По итогам анализа данных необходимо решить, какой из вариантов роликов оставить и использовать в дальнейшем.

Описание данных: id — id респондента, age — возраст респондента, group — группа (тестовая или
контрольная), vote — решение о покупке (1 — хочет купить, 0 — не хочет, 2 — нет ответа).

**Часть 1: R**
1. Загрузите данные из файла parfume.csv в датафрейм parf.

```{r}
parf <- read.csv('parfume.csv', row.names = 1)
View(parf)
```

2. Оставьте в датафрейме только те строки, которые соответствуют девушкам, предоставившим ответ на вопрос о решении купить/не купить парфюмерную воду. В последующих заданиях необходимо работать с обновленным датафреймом.

```{r}
parf <- parf[parf$vote != 2, ]
View(parf)
```


3. Для описания имеющихся данных постройте две столбиковые диаграммы (bar plots), которые показывают, сколько девушек хотели/не хотели бы приобрести парфюмерную воду Black & White в контрольной и тестовой группе (одна диаграмма для одной группы). Приведите графики в порядок, добавьте содержательные подписи и названия.
Подсказка: используйте функцию table() для получения числа нулей и единиц в столбце vote, а затем воспользуйтесь графической функцией barplot().

```{r}
# подготавливаем данные для графиков в контрольной и тестовой группах
contr.group <- table(parf[parf$group == 'control', 'vote'])
test.group <- table(parf[parf$group == 'test', 'vote'])


# строим график для контрольной группы
barplot(contr.group, 
        main = 'Распределение ответов в контрольной группе',
        col = 'lightcoral',
        xlab = 'Ответ',
        ylab = 'Кол-во',
        names.arg = c('Не хочет купить', 'Хочет купить'))

# строим график для тестовой группы
barplot(test.group, 
        main = 'Распределение ответов в тестовой группе',
        col = 'lightblue2',
        xlab = 'Ответ',
        ylab = 'Кол-во',
        names.arg = c('Не хочет купить', 'Хочет купить'))


```


4. Сохраните в вектор test ответы на вопрос о решении купить/не купить парфюмерную воду всех девушек, которые были в тестовой группе. Сохраните в вектор control ответы на вопрос о решении купить/не купить парфюмерную воду всех девушек, которые были в контрольной группе.
Подсказка: сначала отберите строки, соответствующие этим девушкам, а потом извлеките из получен- ного датафрема нужный столбец.

```{r}
# фильтруем занчения в датасете по группам тестовая/контрольная
test <- parf[parf$group == 'test', 'vote']
control <- parf[parf$group == 'control', 'vote']
# определяем разницу долей на реальных даных
p = mean(test) - mean(control)
```


5. Сформулируйте нулевую гипотезу и одностороннюю альтернативную гипотезу, выдвигаемые для принятия решения о выборе одного из двух рекламных роликов (какой из роликов предпочла большая доля девушек). Считайте, что по мнению экспертов, ожидается, что черно-белый ролик будет более предпочтительным.

```{r}
# Н(0) : p(bw) = p(col) доля желающих купить после просмотра чернобелого ролика равна доле желающих купить после просмотра цветной рекламы

# H(1) : p(bw) > p(col) доля желающих купить парфюм после просмотра черноболой рекламы выше, чем после просмотра цветного ролика

```


6. Используя бутстрэп с числом итераций N = 1000, найдите p-value для разности долей девушек, которые захотели купить Black & White в контрольной и тестовой группах. Для воспроизводимости результатов зафиксируйте стартовую точку с помощью set.seed(123). Не забудьте о центрировании, которое обсуждалось в практическом задании 1.

```{r}
N = 1000

# создаем вектор differences, содержащий разницы долей иммитированных данных
set.seed(123)
differences <- rep(NA, N)
for (i in 1:N){
  s.bw <- sample(test, replace = TRUE)
  s.cor <- sample(control, replace = TRUE)
  p.bw <- mean(s.bw)
  p.cor <- mean(s.cor)
  differences[i] <- p.bw - p.cor
}

# центрируем вектор разниц долей
differences <- differences - mean(differences)

# находим p.value, в нашем случае нас интересует доля разниц долей, которые равны или превышают разницу долей реальных данных, так как у нас направленная альтернативная гипотеза. 
p.value <- sum(differences >= p) / N

# строим гистограмму для наглядности
hist(differences)
abline(v = p.value, col = 'red')
```

7. Сделайте статистический вывод на основе полученного p-value, приняв уровень значимости равным 5% (отвергается или не отвергается нулевая гипотеза). Сделайте содержательный вывод о выборе рекламного ролика (какой из вариантов лучше).

```{r}
# Таким образом на уровне значимости 5% мы можем заключить, что доля людей желающих купить парфюм после просмотра чернобелой рекламы выше доли людей желающих купить парфюм после просмотра цветного ролика. На уровне значимости 5% мы отвергаем нулевую гипотезу на имеющихся данных. 


# Содержательный вывод: Для запуска рекламной компании лучше использовать чернобелый рекламный ролик, так как после его просмотра доля желающих купить парфюм выше, чем после просморта цветной рекламы. 
```

