---
title: "practice_6_4"
output: html_document
date: "2023-01-12"
---

```{r}
library(tidyverse)
```


Файл conversion.csv содержит данные для АВ-тестирования, проводимого с целью понять, приводит ли переход к новому типу меню к увеличению конверсии сайта.

Столбцы содержат значения 0 и 1, где 1 соответствует пользователю, который кликнул на меню и продолжил знакомство с сайтом, 0 – пользователю, который не стал продолжать знакомство с сайтом. Столбец OLD соответствует сайту со старым меню, а столбец NEW – сайту с новым меню.

1. Используя R, реализуйте бутстрэп с числом итераций N = 1500 для проверки гипотезы об отсутствии различий в значениях конверсии. Посчитайте p-value.

```{r}
dat <- read.csv('conversion.csv', row.names = 1)
View(dat)
```

```{r}
old <- dat$OLD
new <- dat$NEW
p = (sum(new) / length(new)) - (sum(old) / length(old))
p
```


```{r}
set.seed(5)
N <- 1500
differences <- rep(NA, N)
for (i in 1:N){
  s1 <- sample(old, replace = TRUE)
  s2 <- sample(new, replace = TRUE)
  p1 <- sum(s1) / length(s1)
  p2 <- sum(s2) / length(s2)
  differences[i] <- p2 - p1
}

p.value <- sum(differences >= p) / N

p.value
```


2. Для визуализации полученного p-value постройте, используя ggplot2, гистограмму распределения разностей долей, отметив красной вертикальной линией значение разности, равное 0.
Подсказка. Создайте датафрейм diff_df с одним столбцом, в котором хранятся значения разностей. Для добавления вертикальной линии используйте слой geom_vline().

```{r}
diff_df <- cbind.data.frame(differences, row.names = c(1:N))
ggplot(diff_df, aes(x = differences)) +
  geom_histogram(fill = 'skyblue', color = 'white') +
  geom_vline(xintercept = 0, color = 'red') +
  theme_bw() 

diff_df
```



3. Проверьте, согласуются ли полученные результаты с интуицией. Другими словами, правда ли разница p_new - p_old кажется такой маленькой, как показывает значение p-value и график?


Важно! В уроке у нас результаты совпадали с интуицией: разница невелика, p-value, наоборот, велико, поэтому не отвергаем гипотезу об отсутствии различий. Здесь мы получили что-то странное: разница в долях велика, но и p-value велико!
На самом деле, когда мы используем бутстрэп, мы получаем распределение долей на основе наших данных, которое отличается от распределения долей, ожидаемого в случае, если нулевая гипотеза верна, в случае, если различий действительно нет. Если различий в долях действительно нет, то разница между ними равна нулю. А тогда и значения долей на гистограмме должны располагаться симметрично относительно нуля!
На нашей гистограмме значения симметричны относительно значения, сильно отличного от нуля. Как быть? Для вычисления p-value и построения графика центрировать разность долей, то есть из каждого значения в векторе разностей вычесть среднее значение по этому вектору.


4. Используя уточнения из предыдущего пункта, пересчитайте p-value и постройте новый график. 

```{r}
differences <- differences - mean(differences)
p.value <- sum(differences >= p) / N
p.value
```

```{r}
diff_df <- cbind.data.frame(differences, row.names = c(1:N))
ggplot(diff_df, aes(x = differences)) +
  geom_histogram(fill = 'skyblue', color = 'white') +
  geom_vline(xintercept = 0, color = 'red') +
  theme_bw()
```



5. Сделайте вывод о том, есть ли различия в значениях конверсии старой и новой версии сайта.

```{r}
# Так как p.value меньше 0.05, мы отвергаем нулевую кипотезу на уровне значимости 5%, на имеющихся данных. 

# На уровне значимости 5% мы можем заключить, что разница в конверсии на новом и старом сайте есть. Мы опровергли нашу нулевую гипотезу. 
```



